---

## TypeSafe TS Add-On — “@” Aliases (Free / Premium / Wow++)

> Use **TypeScript path aliases** (configured in the consuming repo’s `tsconfig.json`) to avoid brittle `../` imports.

### Free — Core Types (drop-in, zero deps)
```ts
// @types/finance.ts
export interface LoanTerms {
  /** APR as decimal (e.g., 0.065) */
  rate: number;
  /** Term in months (e.g., 36, 60) */
  term: number;
  /** Optional down payment (>= 0) */
  down?: number;
}

export interface PaymentScheduleItem {
  month: number;
  principal: number;
  interest: number;
  balance: number;
}
```

### Premium — Validation Guards (keep pure & deterministic)
```ts
// @utils/financeGuard.ts
import type { LoanTerms } from '@types/finance';

export function isValidTerms(t: LoanTerms): boolean {
  const rateOk = Number.isFinite(t.rate) && t.rate >= 0 && t.rate <= 0.5;
  const termOk = Number.isInteger(t.term) && t.term >= 1 && t.term <= 120;
  const downOk = t.down === undefined || (Number.isFinite(t.down) && t.down >= 0);
  return rateOk && termOk && downOk;
}

export function explainInvalid(t: LoanTerms): string | null {
  if (!(Number.isFinite(t.rate) && t.rate >= 0 && t.rate <= 0.5)) return "rate must be 0..0.5";
  if (!(Number.isInteger(t.term) && t.term >= 1 && t.term <= 120)) return "term must be 1..120 months";
  if (!(t.down === undefined || (Number.isFinite(t.down) && t.down >= 0))) return "down must be >= 0";
  return null;
}
```

### Wow++ — Deterministic AI Helpers (no network; explainable)
```ts
// @ai/loanPlanner.ts
import type { LoanTerms } from '@types/finance';
import { isValidTerms, explainInvalid } from '@utils/financeGuard';

export function estimateMonthly(principal: number, terms: LoanTerms): number {
  if (!isValidTerms(terms)) throw new Error(explainInvalid(terms) ?? "invalid terms");
  const P = Math.max(0, principal - (terms.down ?? 0));
  const r = terms.rate / 12;
  const n = terms.term;

  if (r === 0) return Math.round((P / Math.max(1, n)) * 100) / 100;

  const f = (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
  return Math.round(P * f * 100) / 100;
}

export function explainPlan(principal: number, terms: LoanTerms): string {
  const P = Math.max(0, principal - (terms.down ?? 0));
  const m = estimateMonthly(principal, terms);
  return `Monthly payment computed from APR=${terms.rate} over ${terms.term} months using standard amortization. Principal after down: ${P}. Estimated monthly: ${m}.`;
}
```

### Instructions for the Orchestrator
- **Generate** `.ts/.tsx` using these patterns; **validate** vs CFH lint.
- **Output to** `artifacts/generated/20250923_084351/*`.
- Prefer imports like `@types/…`, `@utils/…`, `@ai/…` rather than relative paths.
- Keep logic **deterministic** (no network calls) and ensure **mypy/ruff/CI** stay green.

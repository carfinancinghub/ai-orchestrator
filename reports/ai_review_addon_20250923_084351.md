# Add-On: TypeSafe & “@” Alias Enforcement (Run 20250923_2212)

Use these **additional** fences to reinforce typing, alias imports, and gate-compliance. Total fences: **7**.

```ts
// @types/finance/Amortization.ts
import type { PaymentBreakdown } from '@types/finance/PaymentBreakdown';
export interface AmortizationTable {
  schedule: PaymentBreakdown[];
  totalInterest: number;
  totalPaid: number;
}
ts
Copy code
// @services/amortization.ts
import type { LoanTerms } from '@types/finance/LoanTerms';
import type { AmortizationTable } from '@types/finance/Amortization';
import { calculateMonthly } from '@ai/loanPlanner';

export function buildAmortization(t: LoanTerms): AmortizationTable {
  const pmt = calculateMonthly(t);
  let balance = t.principal;
  const schedule = Array.from({ length: t.termMonths }, (_, idx) => {
    const month = idx + 1;
    const i = (t.rateAPR / 12) * balance;
    const principalPortion = Math.max(0, pmt - i);
    balance = Math.max(0, balance - principalPortion);
    return { month, principalPortion, interestPortion: i, balance };
  });
  const totalInterest = schedule.reduce((s, r) => s + r.interestPortion, 0);
  const totalPaid = pmt * t.termMonths;
  return { schedule, totalInterest, totalPaid };
}
ts
Copy code
// @types/finance/Result.ts
export type Currency = number & { __brand: 'USD' };
export interface PlannerResult {
  monthly: Currency;
  totalInterest: Currency;
  totalPaid: Currency;
}
ts
Copy code
// @services/summary.ts
import type { LoanTerms } from '@types/finance/LoanTerms';
import type { PlannerResult } from '@types/finance/Result';
import { calculateMonthly } from '@ai/loanPlanner';
import { buildAmortization } from '@services/amortization';

export function summarize(t: LoanTerms): PlannerResult {
  const monthly = calculateMonthly(t);
  const table = buildAmortization(t);
  return {
    monthly: monthly as any,
    totalInterest: table.totalInterest as any,
    totalPaid: table.totalPaid as any,
  };
}
tsx
Copy code
// @components/MonthlyBox.tsx
import React from 'react';
import type { LoanTerms } from '@types/finance/LoanTerms';
import { summarize } from '@services/summary';

export const MonthlyBox: React.FC<{ terms: LoanTerms }> = ({ terms }) => {
  const s = summarize(terms);
  return <strong data-testid="monthly-box">${s.monthly.toFixed(2)}</strong>;
};
ts
Copy code
// @index.ts
export * from '@types/finance/LoanTerms';
export * from '@types/finance/PaymentBreakdown';
export * from '@types/finance/Amortization';
export * from '@types/finance/Result';
export * from '@utils/financeGuard';
export * from '@ai/loanPlanner';
export * from '@services/amortization';
export * from '@services/summary';
ts
Copy code
// @tests/smoke.ts
import { calculateMonthly } from '@ai/loanPlanner';
import type { LoanTerms } from '@types/finance/LoanTerms';

const t: LoanTerms = { principal: 25000, rateAPR: 0.0799, termMonths: 60 };
const pmt = calculateMonthly(t);
if (!isFinite(pmt) || pmt <= 0) {
  throw new Error('monthly payment invalid');
}
Notes
All imports use “@” aliases — no relative paths.

Types are explicit; functions are pure; numbers represent USD unless noted.

Safe for CFH gates (no node_modules, no .js/.jsx).

# CFH TypeScript Migration — AI Review (Run 20250923_2212)

**Source of truth** for synthesizing ≤25 TypeSafe `.ts`/`.tsx` files.  
**Use “@” path aliases** (e.g., `@types/finance`, `@utils/financeGuard`, `@ai/loanPlanner`, `@components/LoanCalc`) — no `"../"` imports.  
**Output dir:** `artifacts/generated/20250923_2212/` (SHA1 fail-closed; do not overwrite mismatched SHA1).  
**Gates:** vendor/no-js/CFH lint (hard).  
**LoanTerms** must expose `calculateMonthly()` or be paired with a planner that does.

---

## Free Tier — Typed interfaces & modules

```ts
// @types/finance/LoanTerms.ts
export interface LoanTerms {
  principal: number;   // dollars
  rateAPR: number;     // annual rate, e.g. 0.0799
  termMonths: number;  // e.g. 60
}
ts
Copy code
// @types/finance/PaymentBreakdown.ts
export interface PaymentBreakdown {
  month: number;
  principalPortion: number;
  interestPortion: number;
  balance: number;
}
ts
Copy code
// @utils/numbers.ts
export const toCents = (v: number): number => Math.round(v * 100);
export const fromCents = (c: number): number => c / 100;
Premium Tier — Validation & guards
ts
Copy code
// @utils/financeGuard.ts
import type { LoanTerms } from '@types/finance/LoanTerms';

export function isValidTerms(t: LoanTerms): boolean {
  return Number.isFinite(t.principal) && t.principal > 0
      && Number.isFinite(t.rateAPR)   && t.rateAPR   >= 0
      && Number.isFinite(t.termMonths)&& t.termMonths > 0;
}
ts
Copy code
// @utils/Validator.ts
export const Validator = {
  positive: (n: number) => Number.isFinite(n) && n > 0,
  nonNegative: (n: number) => Number.isFinite(n) && n >= 0,
};
Wow++ Tier — Planner with monthly payment
ts
Copy code
// @ai/Optimizer.ts
export const AIOptimizer = {
  monthlyPayment(rateAPR: number, termMonths: number, principal: number): number {
    const i = rateAPR / 12;
    if (i === 0) return principal / termMonths;
    const f = (i * Math.pow(1 + i, termMonths)) / (Math.pow(1 + i, termMonths) - 1);
    return principal * f;
  },
};
ts
Copy code
// @ai/loanPlanner.ts
import type { LoanTerms } from '@types/finance/LoanTerms';
import { AIOptimizer } from '@ai/Optimizer';

export function calculateMonthly(t: LoanTerms): number {
  return AIOptimizer.monthlyPayment(t.rateAPR, t.termMonths, t.principal);
}
tsx
Copy code
// @components/LoanCalc.tsx
import React from 'react';
import type { LoanTerms } from '@types/finance/LoanTerms';
import { calculateMonthly } from '@ai/loanPlanner';

export const LoanCalc: React.FC<{ terms: LoanTerms }> = ({ terms }) => {
  const pmt = calculateMonthly(terms);
  return <div data-testid="monthly-payment">${pmt.toFixed(2)}</div>;
};
Synthesis Instructions
Parse all ts/tsx fences above (7 total) and materialize files under artifacts/generated/20250923_2212/ with the same virtual paths after @ (e.g., @ai/loanPlanner.ts → artifacts/generated/20250923_2212/ai/loanPlanner.ts).

Enforce import “@” aliases (no relative "../").

Before writing any file, compute SHA1 of the would-be bytes; if a file already exists with a different SHA1, fail closed.

Run gates with AIO_RUN_GATES=1; if green, proceed to upload batch to PR #17 in carfinancinghub/cfh (branch ts-migration/generated/20250923_2212).

Record outputs and gate results to:

reports/gates_20250923_2212.json

reports/test_pipeline_20250923_2212.md


---
title: "AI Review Suggestions — Run 20250923_084351 (enhanced)"
date: "2025-09-23T08:43:51-07:00"
source:
  - "artifacts/reviews/20250923_084351/*.json"
  - "C:\\cfh_consolidated"
outputs_dir: "artifacts/generated/20250923_084351"
notes:
  - "TypeScript-focused suggestions; deterministic (no network calls)."
  - "Validate with CFH lint; keep batch sizes ≤ 25."
---

# AI Review Suggestions — Run 20250923_084351

This file provides **tiered, concrete** patterns for the migration. Use them to generate `.ts/.tsx` in `artifacts/generated/20250923_084351/*`, then run gates and upload ≤25 files.

## Free — Basic Types
```ts
export interface LoanTerms {
  /** APR decimal, e.g., 0.065 for 6.5% */
  rate: number;
  /** total months, e.g., 60 */
  term: number;
  /** optional down payment */
  down?: number;
}

export interface PaymentScheduleItem {
  month: number;
  principal: number;
  interest: number;
  balance: number;
}
```

## Premium — Validation & Constructors
```ts
export interface LoanTermsValidated extends LoanTerms {
  validate(): boolean;
}

export function makeLoanTerms(rate:number, term:number, down=0): LoanTermsValidated {
  return {
    rate, term, down,
    validate() {
      if (!Number.isFinite(rate) || rate < 0 || rate > 0.5) return false;
      if (!Number.isInteger(term) || term < 1 || term > 120) return false;
      if (!Number.isFinite(down) || down < 0) return false;
      return true;
    }
  };
}
```

### Diagnostics helper (optional)
```ts
export function explainInvalid(t: LoanTermsValidated): string | null {
  if (!Number.isFinite(t.rate) || t.rate < 0 || t.rate > 0.5) return "rate out of bounds (0..0.5)";
  if (!Number.isInteger(t.term) || t.term < 1 || t.term > 120) return "term must be 1..120 months";
  if (!Number.isFinite(t.down) || (t.down ?? 0) < 0) return "down must be ≥ 0";
  return null;
}
```

## Wow++ — Deterministic AI Helpers (no network)
```ts
export interface LoanTermsAI extends LoanTerms {
  /** Rounded to cents */
  estimateMonthly(principal: number): number;
  /** Optional explanation for UI */
  explainPlan?(principal: number): string;
}

export function mkLoanAI(rate:number, term:number, down=0): LoanTermsAI {
  const r = rate / 12;
  return {
    rate, term, down,
    estimateMonthly(P:number) {
      const principal = Math.max(0, P - (down ?? 0));
      if (!Number.isFinite(principal) || term <= 0) return NaN;
      if (r === 0) return Math.round((principal / term) * 100) / 100;
      const f = (r * Math.pow(1 + r, term)) / (Math.pow(1 + r, term) - 1);
      return Math.round((principal * f) * 100) / 100;
    },
    explainPlan(P:number) {
      return `Monthly payment via standard amortization at ${(rate*100).toFixed(2)}% APR for ${term} months (down ${(down??0).toFixed(2)}).`;
    }
  };
}
```

---

### AI Instructions
- Generate `.ts/.tsx` for financing modules using the patterns above.
- Validate with **CFH lint (hard)** and the repo gates.
- Write outputs to `artifacts/generated/20250923_084351/*`.
- Keep batches ≤ 25 files; avoid overwriting by name/SHA1.
---

## TypeSafe TS Add-On — “@” Aliases (Free / Premium / Wow++)

> Use **TypeScript path aliases** (configured in the consuming repo’s `tsconfig.json`) to avoid brittle `../` imports.

### Free — Core Types (drop-in, zero deps)
```ts
// @types/finance.ts
export interface LoanTerms {
  /** APR as decimal (e.g., 0.065) */
  rate: number;
  /** Term in months (e.g., 36, 60) */
  term: number;
  /** Optional down payment (>= 0) */
  down?: number;
}

export interface PaymentScheduleItem {
  month: number;
  principal: number;
  interest: number;
  balance: number;
}
```

### Premium — Validation Guards (keep pure & deterministic)
```ts
// @utils/financeGuard.ts
import type { LoanTerms } from '@types/finance';

export function isValidTerms(t: LoanTerms): boolean {
  const rateOk = Number.isFinite(t.rate) && t.rate >= 0 && t.rate <= 0.5;
  const termOk = Number.isInteger(t.term) && t.term >= 1 && t.term <= 120;
  const downOk = t.down === undefined || (Number.isFinite(t.down) && t.down >= 0);
  return rateOk && termOk && downOk;
}

export function explainInvalid(t: LoanTerms): string | null {
  if (!(Number.isFinite(t.rate) && t.rate >= 0 && t.rate <= 0.5)) return "rate must be 0..0.5";
  if (!(Number.isInteger(t.term) && t.term >= 1 && t.term <= 120)) return "term must be 1..120 months";
  if (!(t.down === undefined || (Number.isFinite(t.down) && t.down >= 0))) return "down must be >= 0";
  return null;
}
```

### Wow++ — Deterministic AI Helpers (no network; explainable)
```ts
// @ai/loanPlanner.ts
import type { LoanTerms } from '@types/finance';
import { isValidTerms, explainInvalid } from '@utils/financeGuard';

export function estimateMonthly(principal: number, terms: LoanTerms): number {
  if (!isValidTerms(terms)) throw new Error(explainInvalid(terms) ?? "invalid terms");
  const P = Math.max(0, principal - (terms.down ?? 0));
  const r = terms.rate / 12;
  const n = terms.term;

  if (r === 0) return Math.round((P / Math.max(1, n)) * 100) / 100;

  const f = (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
  return Math.round(P * f * 100) / 100;
}

export function explainPlan(principal: number, terms: LoanTerms): string {
  const P = Math.max(0, principal - (terms.down ?? 0));
  const m = estimateMonthly(principal, terms);
  return `Monthly payment computed from APR=${terms.rate} over ${terms.term} months using standard amortization. Principal after down: ${P}. Estimated monthly: ${m}.`;
}
```

### Instructions for the Orchestrator
- **Generate** `.ts/.tsx` using these patterns; **validate** vs CFH lint.
- **Output to** `artifacts/generated/20250923_084351/*`.
- Prefer imports like `@types/…`, `@utils/…`, `@ai/…` rather than relative paths.
- Keep logic **deterministic** (no network calls) and ensure **mypy/ruff/CI** stay green.


## CFH TypeSafe Review — Run 20250923_2212 (authoritative fences)

> Use only the fences below to generate `.ts/.tsx`. Enforce “@” path aliases; no relative `../`.
> Output dir: `artifacts/generated/20250923_2212/` (SHA1 fail-closed).

### Free — Core financial types
```ts path=@types/finance/LoanTerms.ts
export interface LoanTerms {
  principal: number;        // dollars
  annualRatePct: number;    // APR in %
  termMonths: number;       // 12..96
}
```

```ts path=@utils/math/percent.ts
export const pctToRate = (aprPct: number) => aprPct / 100;
```

### Premium — Guards & validation
```ts path=@utils/financeGuard.ts
export const isPositive = (n: number) => Number.isFinite(n) && n > 0;
export const isWhole    = (n: number) => Number.isInteger(n) && n > 0;
export function validateTerms(t: {principal:number; annualRatePct:number; termMonths:number}) {
  return isPositive(t.principal) && isPositive(t.annualRatePct) && isWhole(t.termMonths);
}
```

```ts path=@ai/loanPlanner.ts
import type { LoanTerms } from '@types/finance/LoanTerms';
import { pctToRate } from '@utils/math/percent';
import { validateTerms } from '@utils/financeGuard';

export function monthlyPayment(terms: LoanTerms): number {
  if (!validateTerms(terms)) throw new Error('Invalid LoanTerms');
  const r = pctToRate(terms.annualRatePct) / 12;
  const n = terms.termMonths;
  const P = terms.principal;
  if (r === 0) return +(P / n).toFixed(2);
  const m = (P * r) / (1 - Math.pow(1 + r, -n));
  return +m.toFixed(2);
}
```

### Wow++ — Components + API (TypeSafe, deterministic)
```ts path=@components/LoanCalc/LoanCalc.types.ts
export type PaymentBreakdown = { principal: number; interest: number; remaining: number };
export interface LoanCalcProps {
  terms: { principal: number; annualRatePct: number; termMonths: number };
  onChange?: (next: LoanCalcProps['terms']) => void;
}
```

```tsx path=@components/LoanCalc/LoanCalc.tsx
import React from 'react';
import type { LoanCalcProps } from './LoanCalc.types';
import { monthlyPayment } from '@ai/loanPlanner';

export default function LoanCalc({ terms, onChange }: LoanCalcProps) {
  const payment = monthlyPayment(terms);
  return (
    <div data-testid="loan-calc">
      <div>Monthly payment: ${payment.toFixed(2)}</div>
      {/* UI inputs would call onChange?.(…) */}
    </div>
  );
}
```

```ts path=@api/loans/types.ts
export interface QuoteRequest { principal:number; annualRatePct:number; termMonths:number }
export interface QuoteResponse { monthly:number }
```

```ts path=@api/loans/service.ts
import type { QuoteRequest, QuoteResponse } from './types';
import { monthlyPayment } from '@ai/loanPlanner';

export function quote(req: QuoteRequest): QuoteResponse {
  return { monthly: monthlyPayment(req) };
}
```

> Instructions to Cod1: Generate `.ts/.tsx` from these fences only; enforce “@” aliases; write to `artifacts/generated/20250923_2212/*` with SHA1 no-overwrite; validate with CFH lint (hard). No `node_modules/**` traversal.
